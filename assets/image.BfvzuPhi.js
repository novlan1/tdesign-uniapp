import{c as s,w as e,l as a,m as i,i as l,e as t,o,f as r,p as d,j as n,t as c,g as h,v as p}from"./index-Ccz-JnLB.js";import{t as g}from"./loading.BHIQUGit.js";import{S as y,c as f,_ as m,t as u,e as x,f as _,g as S,h as L,i as v,d as w,w as P}from"./icon.DXPC0WoT.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b={error:{type:String,value:"default"},height:{type:null},lazy:{type:Boolean,value:!1},loading:{type:String,value:"default"},mode:{type:String,value:"scaleToFill"},shape:{type:String,value:"square"},showMenuByLongpress:{type:Boolean,value:!1},src:{type:String,value:""},tId:{type:String,value:""},webp:{type:Boolean,value:!1},width:{type:null}},{prefix:k}=f,z=`${k}-image`;let F=class extends y{constructor(){super(...arguments),this.externalClasses=[`${k}-class`,`${k}-class-load`,`${k}-class-image`,`${k}-class-error`],this.options={multipleSlots:!0},this.properties=b,this._=m,this.components={tLoading:g,tIcon:u},this.setData({prefix:k,isLoading:!0,isFailed:!1,innerStyle:"",classPrefix:z}),this.preSrc=void 0,this.observers={src(){this.preSrc!==this.src&&this.update()},"width, height"(s,e){this.calcSize(s,e)}},this.lifetimes={ready(){this.calcSize(this.width,this.height)}},this.methods={onLoaded(s){const e=x.SDKVersion,{mode:a,tId:i}=this;console.log("version",e);const l=_(e,"2.10.3")<0;"heightFix"===a&&l&&(console.log("onLoaded",s),console.log("onLoaded",s),S(this,`#${i||"image"}`).then(s=>{const{height:e,width:a}=s;console.log("getRect",s),this.setData({innerStyle:`height: ${L(e)}; width: ${a}px;`})}).catch(s=>{console.log("err",s)})),this.setData({isLoading:!1,isFailed:!1}),this.$emit("load",{detail:s.detail})},onLoadError(s){this.setData({isLoading:!1,isFailed:!0}),this.$emit("error",{detail:s.detail})},calcSize(s,e){console.log("calcSizing",s,e);let a="";s&&(a+=`width: ${L(s)};`),e&&(a+=`height: ${L(e)};`),this.setData({innerStyle:a})},update(){const{src:s}=this;this.preSrc=s,s?this.setData({isLoading:!0,isFailed:!1}):this.onLoadError({errMsg:"图片链接为空"})}}}setData(){}};F=v(w([P()],F));const D=$(F,[["render",function(g,y,f,m,u,x){const _=t("t-loading"),S=l,L=t("t-icon"),v=p;return o(),s(S,{style:i(g._._style([g.style,g.customStyle])),class:a("class "+g.prefix+"-class "+g.classPrefix)},{default:e(()=>[g.isLoading?(o(),s(S,{key:0,style:i(g._._style([g.innerStyle])),class:a(g.classPrefix+"__mask "+g.classPrefix+"--loading "+g.classPrefix+"--shape-"+g.shape),"aria-hidden":g.ariaHidden},{default:e(()=>["default"===g.loading?(o(),s(_,{key:0,theme:"dots",size:"44rpx",loading:"","inherit-color":"","t-class":"t-class-load","t-class-text":g.classPrefix+"--loading-text"},null,8,["t-class-text"])):""!==g.loading&&"slot"!==g.loading?(o(),s(S,{key:1,class:a(g.classPrefix+"__common "+g.prefix+"-class-load")},{default:e(()=>[n(c(g.loading),1)]),_:1},8,["class"])):d(g.$slots,"loading",{key:2},void 0,!0)]),_:3},8,["style","class","aria-hidden"])):g.isFailed?(o(),s(S,{key:1,style:i(g._._style([g.innerStyle])),class:a(g.classPrefix+"__mask "+g.classPrefix+"--failed "+g.classPrefix+"--shape-"+g.shape+" "+g.prefix+"-class-error"),"aria-hidden":g.ariaHidden},{default:e(()=>["default"===g.error?(o(),s(S,{key:0,style:{"font-size":"44rpx"},class:a(g.prefix+"-class-load")},{default:e(()=>[h(L,{name:"close","aria-role":"img","aria-label":"加载失败"})]),_:1},8,["class"])):g.error&&"slot"!==g.error?(o(),s(S,{key:1,class:a(g.classPrefix+"__common "+g.prefix+"-class-load")},{default:e(()=>[n(c(g.error),1)]),_:1},8,["class"])):d(g.$slots,"error",{key:2},void 0,!0)]),_:3},8,["style","class","aria-hidden"])):r("",!0),g.isFailed?r("",!0):(o(),s(v,{key:2,id:g.tId||"image",style:i(g._._style([g.innerStyle])),class:a(g.classPrefix+"__img "+g.classPrefix+"--shape-"+g.shape+" "+(g.isLoading?g.classPrefix+"--lazy":"")+" "+g.prefix+"-class-image"),src:g.src,mode:g.mode,webp:g.webp,"lazy-load":g.lazy,"show-menu-by-longpress":g.showMenuByLongpress,"aria-hidden":g.ariaHidden||g.isLoading||g.isFailed,"aria-label":g.ariaLabel,onLoad:g.onLoaded,onError:g.onLoadError},null,8,["id","style","class","src","mode","webp","lazy-load","show-menu-by-longpress","aria-hidden","aria-label","onLoad","onError"]))]),_:3},8,["style","class"])}],["__scopeId","data-v-eb112430"]]);export{D as t};
