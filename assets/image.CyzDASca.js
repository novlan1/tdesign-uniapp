import{c as s,w as e,l as a,m as i,i as l,e as t,o,f as d,p as n,j as c,t as h,g as p,v as g}from"./index-B8Thrysu.js";import{t as y}from"./loading.CWFfIxWc.js";import{S as f,c as m,_ as u,t as x,e as _,g as S,f as L,i as v,d as w,w as P}from"./icon.BUmSspeG.js";import{_ as $}from"./_plugin-vue_export-helper.BCo6x5W8.js";const b={error:{type:String,value:"default"},height:{type:null},lazy:{type:Boolean,value:!1},loading:{type:String,value:"default"},mode:{type:String,value:"scaleToFill"},shape:{type:String,value:"square"},showMenuByLongpress:{type:Boolean,value:!1},src:{type:String,value:""},tId:{type:String,value:""},webp:{type:Boolean,value:!1},width:{type:null}},{prefix:k}=m,z=`${k}-image`;let F=class extends f{constructor(){super(...arguments),this.externalClasses=[`${k}-class`,`${k}-class-load`,`${k}-class-image`,`${k}-class-error`],this.options={multipleSlots:!0},this.properties=b,this._=u,this.components={tLoading:y,tIcon:x},this.setData({prefix:k,isLoading:!0,isFailed:!1,innerStyle:"",classPrefix:z}),this.preSrc=void 0,this.observers={src(){this.preSrc!==this.src&&this.update()},"width, height"(s,e){this.calcSize(s,e)}},this.lifetimes={ready(){this.calcSize(this.width,this.height)}},this.methods={onLoaded(s){const e=_.SDKVersion,{mode:a,tId:i}=this;console.log("version",e),"heightFix"===a&&r&&(console.log("onLoaded",s),console.log("onLoaded",s),S(this,`#${i||"image"}`).then(s=>{const{height:e,width:a}=s;console.log("getRect",s),this.setData({innerStyle:`height: ${L(e)}; width: ${a}px;`})}).catch(s=>{console.log("err",s)})),this.setData({isLoading:!1,isFailed:!1}),this.$emit("load",{detail:s.detail})},onLoadError(s){this.setData({isLoading:!1,isFailed:!0}),this.$emit("error",{detail:s.detail})},calcSize(s,e){console.log("calcSizing",s,e);let a="";s&&(a+=`width: ${L(s)};`),e&&(a+=`height: ${L(e)};`),this.setData({innerStyle:a})},update(){const{src:s}=this;this.preSrc=s,s?this.setData({isLoading:!0,isFailed:!1}):this.onLoadError({errMsg:"图片链接为空"})}}}setData(){}};F=v(w([P()],F));const D=$(F,[["render",function(r,y,f,m,u,x){const _=t("t-loading"),S=l,L=t("t-icon"),v=g;return o(),s(S,{style:i(r._._style([r.style,r.customStyle])),class:a("class "+r.prefix+"-class "+r.classPrefix)},{default:e(()=>[r.isLoading?(o(),s(S,{key:0,style:i(r._._style([r.innerStyle])),class:a(r.classPrefix+"__mask "+r.classPrefix+"--loading "+r.classPrefix+"--shape-"+r.shape),"aria-hidden":r.ariaHidden},{default:e(()=>["default"===r.loading?(o(),s(_,{key:0,theme:"dots",size:"44rpx",loading:"","inherit-color":"","t-class":"t-class-load","t-class-text":r.classPrefix+"--loading-text"},null,8,["t-class-text"])):""!==r.loading&&"slot"!==r.loading?(o(),s(S,{key:1,class:a(r.classPrefix+"__common "+r.prefix+"-class-load")},{default:e(()=>[c(h(r.loading),1)]),_:1},8,["class"])):n(r.$slots,"loading",{key:2},void 0,!0)]),_:3},8,["style","class","aria-hidden"])):r.isFailed?(o(),s(S,{key:1,style:i(r._._style([r.innerStyle])),class:a(r.classPrefix+"__mask "+r.classPrefix+"--failed "+r.classPrefix+"--shape-"+r.shape+" "+r.prefix+"-class-error"),"aria-hidden":r.ariaHidden},{default:e(()=>["default"===r.error?(o(),s(S,{key:0,style:{"font-size":"44rpx"},class:a(r.prefix+"-class-load")},{default:e(()=>[p(L,{name:"close","aria-role":"img","aria-label":"加载失败"})]),_:1},8,["class"])):r.error&&"slot"!==r.error?(o(),s(S,{key:1,class:a(r.classPrefix+"__common "+r.prefix+"-class-load")},{default:e(()=>[c(h(r.error),1)]),_:1},8,["class"])):n(r.$slots,"error",{key:2},void 0,!0)]),_:3},8,["style","class","aria-hidden"])):d("",!0),r.isFailed?d("",!0):(o(),s(v,{key:2,id:r.tId||"image",style:i(r._._style([r.innerStyle])),class:a(r.classPrefix+"__img "+r.classPrefix+"--shape-"+r.shape+" "+(r.isLoading?r.classPrefix+"--lazy":"")+" "+r.prefix+"-class-image"),src:r.src,mode:r.mode,webp:r.webp,"lazy-load":r.lazy,"show-menu-by-longpress":r.showMenuByLongpress,"aria-hidden":r.ariaHidden||r.isLoading||r.isFailed,"aria-label":r.ariaLabel,onLoad:r.onLoaded,onError:r.onLoadError},null,8,["id","style","class","src","mode","webp","lazy-load","show-menu-by-longpress","aria-hidden","aria-label","onLoad","onError"]))]),_:3},8,["style","class"])}],["__scopeId","data-v-d13b86df"]]);export{D as t};
